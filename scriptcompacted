import requests
from requests.auth import HTTPBasicAuth
from urllib.parse import quote
import urllib3

urllib3.disable_warnings()

R1_IP = "192.168.1.10"
R2_IP = "192.168.1.11"
USER = "cisco"
PASS = "cisco123!"

def hdr():
    return {"Content-Type":"application/yang-data+json","Accept":"application/yang-data+json"}

def put(url, data):
    return requests.put(url, auth=HTTPBasicAuth(USER,PASS), headers=hdr(), json=data, verify=False)

def intf(ip, name, addr, mask):
    url=f"https://{ip}/restconf/data/ietf-interfaces:interfaces/interface={quote(name,'')}"
    data={"ietf-interfaces:interface":{"name":name,"type":"iana-if-type:ethernetCsmacd","enabled":True,
          "ietf-ip:ipv4":{"address":[{"ip":addr,"netmask":mask}]}}}
    print(ip, name, put(url,data).status_code)

def loop(ip, name, addr, mask):
    url=f"https://{ip}/restconf/data/ietf-interfaces:interfaces/interface={name}"
    data={"ietf-interfaces:interface":{"name":name,"type":"iana-if-type:softwareLoopback","enabled":True,
          "ietf-ip:ipv4":{"address":[{"ip":addr,"netmask":mask}]}}}
    print(ip,name,put(url,data).status_code)

def route(ip, p, m, nh):
    url=f"https://{ip}/restconf/data/Cisco-IOS-XE-native:native/ip/route/ip-route-interface-forwarding-list={p},{m}"
    data={"Cisco-IOS-XE-native:ip-route-interface-forwarding-list":{"prefix":p,"mask":m,"fwd-list":[{"fwd":nh}]}}
    print(ip,"route",put(url,data).status_code)

# R1
intf(R1_IP,"GigabitEthernet0/0/0","10.10.10.1","255.255.255.0")
intf(R1_IP,"GigabitEthernet0/0/1","172.16.1.1","255.255.255.252")
loop(R1_IP,"Loopback1","8.8.8.8","255.255.255.0")
route(R1_IP,"10.10.20.0","255.255.255.0","172.16.1.2")
route(R1_IP,"0.0.0.0","0.0.0.0","172.16.1.2")

# R2
intf(R2_IP,"GigabitEthernet0/0/0","10.10.20.1","255.255.255.0")
intf(R2_IP,"GigabitEthernet0/0/1","172.16.1.2","255.255.255.252")
loop(R2_IP,"Loopback1","9.9.9.9","255.255.255.0")
route(R2_IP,"10.10.10.0","255.255.255.0","172.16.1.1")
